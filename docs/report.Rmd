---
title: "Submarine Cable Analysis for US Marine Renewable Energy Development"
author:
- Benjamin D. Best ^1^
- Levi F. Kilcher ^2^
date: |
  | `r format(Sys.time(), '%Y-%m-%d')`
  | ^1^: EcoQuants, Santa Barbara, CA
  | ^2^: National Renewable Energy Lab, Golden, CO \newline
output:
  bookdown::pdf_document2:
    keep_tex: yes
    number_sections: yes
    toc: yes
    toc_depth: 4
  bookdown::html_document2:
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float: yes
  bookdown::word_document2:
    toc: yes
    toc_depth: 4
lof: yes
csl: energy-efficiency.csl
bibliography: nrel-cables.bib
---

```{r setup, include=FALSE}
# set working directory
if (basename(getwd()) == 'nrel-cables') setwd('docs')

# load packages and variables
source('./packages_vars.R')

#opts_chunk$set(warning=F, message=F)
opts_chunk$set(warning=F, message=F, eval=T, cache=T) # DEBUG
fig_type = 'png' # 'png','pdf','html'
fig_dpi = 300
redo = F

if (interactive() || "rmarkdown.pandoc.to" %in% names(opts_knit$get()) && opts_knit$get("rmarkdown.pandoc.to") == 'html'){
  out_html = T
  #opts_chunk$set(echo=T)
  opts_chunk$set(echo=F)
} else {
  out_html = F
  opts_chunk$set(echo=F)
}

fmt_tbl = function(csv, energy_hdr, caption){

  # read_csv(csv) %>%
  #   mutate(
  #    cable2_pct = cable2_pct/100, 
  #    cable3_pct = cable3_pct/100) %>%
  #   write_csv(csv)
  
  d = read_csv(csv) %>%
    filter(
      territory != 'ALL',
      !is.na(territory))
  
  # correct for odd flipping from using className='dt-right'
  d = d %>%
    mutate(
      energy_lbl = recode(
        energy_lbl, 
        `<=7`='7=>',
        `>30`='30<',
        `>1500`='1500<'))
  
  hdr = htmltools::withTags(table(
    class = 'display',
    thead(
      tr(
        th(rowspan=2, 'Territory'),
        th(rowspan=2, energy_hdr),
        th(rowspan=2, HTML('Area (km<sup>2</sup>)')),
        th(colspan=2, 'Min. Cable (2z)'),
        th(colspan=2, 'Rec. Cable (3z)')),
      tr(
        th(HTML('Area (km<sup>2</sup>)')),
        th('(%)'),
        th(HTML('Area (km<sup>2</sup>)')),
        th('(%)')))))

  d %>%
    mutate(
      territory  = ifelse(duplicated(territory), '', territory),
      energy     = factor(energy_num, unique(energy_num), unique(energy_lbl)),
      area_km2   = accounting(area_km2, digits=0),
      cable2_km2 = accounting(cable2_km2, digits=0),
      cable3_km2 = accounting(cable3_km2, digits=0),
      cable2_pct = percent(cable2_pct, digits=1),
      cable3_pct = percent(cable3_pct, digits=1)) %>%
    select(
      territory, energy, area_km2,
      cable2_km2, cable2_pct, cable3_km2, cable3_pct) %>%
    formattable(
      list(
        energy     = color_bar('lightblue'),
        area_km2   = color_bar('lightgray'),
        cable2_km2 = color_bar('lightpink'),
        cable3_km2 = color_bar('lightgreen'))) %>%
    as.datatable(
      rownames=F, container=hdr, caption=caption,
      options = list(
        dom='t', # off: n_entries/search/paging/ordering
        pageLength = nrow(d), ordering=F,
        columnDefs = list(list(className='dt-right', targets=1:5))))
}

plot_cbls = function(
  csv   = wave_cbls_csv, 
  #title = 'Wave Energy by Area and Power Class per US Territory',
  xlab  = 'Wave energy (kW/m)',
  legend_position      = c(1,0),
  legend_justification = c(1,0)){ 
  
  energy_cbls = read_csv(csv) %>%
    filter(
      !is.na(territory),
      territory != 'ALL') %>%
    mutate(
      energy = factor(energy_lbl, unique(energy_lbl), ordered=T),
      pct_lbl = sprintf('%0.1f - %0.1f%%', cable2_pct*100, cable3_pct*100))
  
  #cable_ord = c('min_2d'='Minimum (2*depth)', 'rec_3d'='+Recommended (3*depth)', 'rem'='Available')
  cable_ord = c('min_2d'='Min.(2z)', 'rec_3d'='+Rec.(3z)', 'rem'='Free')
  
  d_p = energy_cbls %>%
    mutate(
      min_2d = cable2_km2,
      rec_3d = cable3_km2 - cable2_km2,
      rem    = area_km2 - cable3_km2) %>%
    select(
      territory, energy, min_2d, rec_3d, rem) %>%
    gather(type, km2, -energy, -territory) %>%
    mutate(
      type = factor(
        type,
        names(cable_ord),
       cable_ord, ordered=T)) %>%
    arrange(territory, energy, type)
  
  txt_adj = energy_cbls %>% 
    summarize(txt_adj = max(area_km2)/1000*0.025) %>% 
    .$txt_adj
  
  p = ggplot(
      data=d_p,
      aes(x = energy, y = km2/1000, fill=type)) +
    geom_col() +
    geom_text(
      data=energy_cbls, 
      aes(label=pct_lbl, x=energy, y=area_km2/1000, fill=NULL), 
      position = position_nudge(y = txt_adj), size=2) +
    labs(
      #title=title, 
      #subtitle='with Cable Overlay (Minimum - Recommended %)', 
      x=xlab, y='Area (1,000 km^2)', fill='Cable') +
    theme(
      legend.justification = legend_justification, 
      legend.position      = legend_position,
      axis.text.x = element_text(angle = 90, hjust = 1)) + 
    facet_wrap(~territory) # facet_wrap(~territory, scales='free_y') # facet_grid(. ~ territory)
  print(p)
}

fig_exists = function(fig){ 
  fig_ext = sprintf('%s.%s', fig, fig_type)
  file.exists(fig_ext)}

map_cable = function(
  ter,
  fig,
  redo){
  # ter = 'Hawaii'; fig = sprintf('figs/mapCable_%s', str_replace_all(ter,' ','-')); energy_sf = wind_sf; legend_title = sprintf('Submarine cables within %s EEZ.', ter); redo = T
  
  fig_ext = sprintf('%s.%s', fig, fig_type)
  if (!file.exists(fig_ext) | redo){
    
    eez = usa_eez %>%
      filter(territory==ter)
    cables = lns_d1x %>%
      filter(territory==ter)
    cables2 = dx2 %>%
      filter(territory==ter)
    cables3 = dx3 %>%
      filter(territory==ter)
    
    bb = st_bbox(eez)
    bb_ply = st_sf(
      tibble(
        territory = ter,
        geom = st_sfc(st_polygon(list(rbind(
          c(bb['xmin'], bb['ymin']),
          c(bb['xmax'], bb['ymin']),
          c(bb['xmax'], bb['ymax']),
          c(bb['xmin'], bb['ymax']),
          c(bb['xmin'], bb['ymin'])))), crs = 4326)))
    earth = land %>%
      filter(
        st_intersects(land, bb_ply, sparse=F)[,1]) # plot(earth)

    p = ggplot(data=eez) +
      geom_sf(data=earth, fill='gray40', size=0.2, color=NA) +
      geom_sf(data=eez, fill=NA, color='gray40') +
      geom_sf(data=cables3, fill='red', color=NA, alpha=0.15) +
      geom_sf(data=cables2, fill='red', color=NA, alpha=0.15) +
      geom_sf(data=cables, color='red', size=0.1, alpha=0.9) +
      coord_sf(
        xlim=bb[c('xmin','xmax')], 
        ylim=bb[c('ymin','ymax')])
      
    if (fig_type=='pdf'){
      pdf(fig_ext, width=6.5, height=5)
    }  else {
      png(fig_ext, res=fig_dpi, width=6.5, height=5, units='in')
    }
    print(p)
    dev.off()
  }
  #system(sprintf('open %s', fig))
  #knitr::include_graphics(fig, dpi=fig_dpi)
}

map_energy_sf = function(
  energy_sf,
  ter,
  legend_title,
  redo,
  fig){
  # ter = 'Hawaii'; fig = sprintf('figs/mapWind_%s', str_replace_all(ter,' ','-')); energy_sf = wind_sf; legend_title = 'Wind\nspeed\n(m/s)'; redo = T
  
  # TODO: fig_type # fig='htmlwidget'
  fig_ext = sprintf('%s.%s', fig, fig_type)
  #browser()
  if (!file.exists(fig_ext) | redo | fig=='htmlwidget'){
    
    d = energy_sf %>% 
      filter(territory==ter)
    eez = usa_eez %>%
      filter(territory==ter)
    cables = lns_d1x %>%
      filter(territory==ter)
    cables2 = dx2 %>%
      filter(territory==ter)
    cables3 = dx3 %>%
      filter(territory==ter)
    
    bb = st_bbox(d)
    # TODO: st_cast(x=st_bbox, to=st_polygon)                 
    bb_ply = st_sf(
      tibble(
        territory = ter,
        geom = st_sfc(st_polygon(list(rbind(
          c(bb['xmin'], bb['ymin']),
          c(bb['xmax'], bb['ymin']),
          c(bb['xmax'], bb['ymax']),
          c(bb['xmin'], bb['ymax']),
          c(bb['xmin'], bb['ymin'])))), crs = 4326)))
    earth = land %>%
      filter(
        st_intersects(land, bb_ply, sparse=F)[,1]) # plot(earth)

    # TODO: leaflet
    if (fig == 'htmlwidget'){
      pal = colorFactor('YlGnBu', d$energy, reverse=T)
  
      m = leaflet(d) %>% 
        addProviderTiles('Esri.OceanBasemap') %>%
        addPolygons(
          group=legend_title,
          color=NA, smoothFactor = 0.5,
          fillOpacity = 0.5,
          fillColor = ~pal(energy)) %>% #,
          # label = ~sprintf(
          #   "<strong>%s</strong>: %s",
          #   territory, energy) %>% lapply(HTML),
          # highlightOptions = highlightOptions(
          #   color = "white", weight = 2, bringToFront = T)) %>%
        addPolygons(
          data = cables2, group='Min. Cable (2x)',
          color='red', stroke=F, fillOpacity = 0.3) %>%
        addPolygons(
          data = cables3, group='Rec. Cable (3x)',
          color='red', stroke=F, fillOpacity = 0.3) %>%      
        addPolylines(
          data = cables, group='Cables',
          color='red', opacity = 0.8, weight=1) %>% #,
          # popup = ~sprintf(
          #   "scaleBand: %s<br>description: %s<br>effectiveDate: %s<br>Territory: %s<br>Buffer (1x): %d",
          #   scaleBand, description, effectiveDate, territory, buf1x)) %>%
        addLegend(pal=pal, values=~energy, title=legend_title) %>%
        addLayersControl(
          baseGroups = c("B&W", "Ocean"),
          overlayGroups = c(legend_title, 'Min. Cable (2x)', 'Rec. Cable (3x)', 'Cables'),
          options = layersControlOptions(collapsed=T))
    } else {
      
      p = ggplot(data=d) +
        geom_sf(aes(fill=energy), color=NA) +
        scale_fill_brewer(legend_title, palette='YlGnBu', direction=-1) +
        geom_sf(data=earth, fill='gray40', size=0.2, color=NA) +
        geom_sf(data=eez, fill=NA, color='gray40') +
        geom_sf(data=cables3, fill='red', color=NA, alpha=0.15) +
        geom_sf(data=cables2, fill='red', color=NA, alpha=0.15) +
        geom_sf(data=cables, color='red', size=0.1, alpha=0.9) +
        coord_sf(
          xlim=bb[c('xmin','xmax')], 
          ylim=bb[c('ymin','ymax')]) +
        theme(
          legend.background = element_rect(fill='grey90'),  
          legend.key = element_blank())
        
      if (fig_type=='pdf'){
        pdf(fig_ext, width=6.5, height=5)
      }  else {
        png(fig_ext, res=fig_dpi, width=6.5, height=5, units='in')
      }
      print(p)
      dev.off()
    }
  }
  if (fig == 'htmlwidget') m
  #system(sprintf('open %s', fig))
  #knitr::include_graphics(fig, dpi=fig_dpi)
}

map_tide = function(
  ter,
  legend_title,
  redo,
  fig){
  # ter = 'Alaska'; fig = sprintf('figs/mapTide_%s', str_replace_all(ter,' ','-')); legend_title = 'Tidal\npower\n(W/m2)'; redo = T
  
  fig_ext = sprintf('%s.%s', fig, fig_type)
  if (!file.exists(fig_ext) | redo){
    
    ter_str = str_replace_all(ter, ' ', '-')
    tif = sprintf('../data/tide_ter-%s.tif', ter_str)
    r = raster(tif)

    #d = energy_sf %>% 
    #  filter(territory==ter)
    eez = usa_eez %>%
      filter(territory==ter)
    cables = lns_d1x %>%
      filter(territory==ter)
    cables2 = dx2 %>%
      filter(territory==ter)
    cables3 = dx3 %>%
      filter(territory==ter)
    
    bb = bbox(r)
    bb = c(xmin=bb[1,1], xmax=bb[1,2], ymin=bb[2,1], ymax=bb[2,2])
    # TODO: st_cast(x=st_bbox, to=st_polygon)                 
    bb_ply = st_sf(
      tibble(
        territory = ter,
        geom = st_sfc(st_polygon(list(rbind(
          c(bb['xmin'], bb['ymin']),
          c(bb['xmax'], bb['ymin']),
          c(bb['xmax'], bb['ymax']),
          c(bb['xmin'], bb['ymax']),
          c(bb['xmin'], bb['ymin'])))), crs = 4326)))
    earth = land %>%
      filter(
        st_intersects(land, bb_ply, sparse=F)[,1])

    # https://nrelscience.org/2013/05/30/this-is-how-i-did-it-mapping-in-r-with-ggplot2/
    d = as.data.frame(r, xy=T) %>% as_tibble()
    colnames(d) <- c('lon','lat','value')
    d = d %>% filter(!is.na(value))
    
    p = ggplot() + 
      geom_raster(data=d, aes(x=lon, y=lat, fill=value)) + 
      scale_fill_gradientn(
        legend_title,
        colours=rev(brewer.pal(11,'YlGnBu')),
        limits=c(0,cellStats(r, 'max')),
        na.value = 'transparent') +
      geom_sf(data=earth, fill='gray40', size=0.2, color=NA) +
      geom_sf(data=eez, fill=NA, color='gray40') +
      geom_sf(data=cables3, fill='red', color=NA, alpha=0.15) +
      geom_sf(data=cables2, fill='red', color=NA, alpha=0.15) +
      geom_sf(data=cables, color='red', size=0.1, alpha=0.9) +
      coord_sf(
        xlim=bb[c('xmin','xmax')], 
        ylim=bb[c('ymin','ymax')]) +
      theme(
        legend.background = element_rect(fill='grey90'),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),  
        legend.key = element_blank())
      
    if (fig_type=='pdf'){
      pdf(fig_ext, width=6.5, height=5)
    }  else {
      png(fig_ext, res=fig_dpi, width=6.5, height=5, units='in')
    }
    print(p)
    dev.off()
    
  }
  #system(sprintf('open %s', fig))
  #knitr::include_graphics(fig_ext, auto_pdf=F, dpi=fig_dpi)
}

# calculate length of cables / comment to speed up
# lns_km = read_sf(lns_geo) %>%
#   mutate(
#     length = st_length(geometry)) %>%
#   summarize(length_km = sum(length)/1000) %>% 
#   .$length_km %>% as.numeric()
# 
# lns_d1x_km = lns_d1x %>%
#   mutate(
#     length = st_length(geometry)) %>%
#   summarize(length_km = sum(length)/1000) %>% 
#   .$length_km %>% as.numeric()
lns_km = 230834.9
lns_d1x_km = 97321.2

# revert to old red-green-blue default color, not new viridis
#   per https://github.com/tidyverse/ggplot2/blob/00ecd3670ef0f1c195bf4c6b5ada3b1895712f1c/NEWS.md#ggplot2-2219000
scale_fill_ordinal = scale_fill_hue

#usa2    = wrld2 %>% filter(ID=='USA')
wrld2   = st_as_sf(map('world2', plot=F, fill=T))
usa_eez = read_sf(usa_rgn_geo)
land    = read_sf(land_usaeez_geo)
lns_d1x = read_sf(lns_d1x_rgn_geo)
dx2     = read_sf(dx2_geo)
dx3     = read_sf(dx3_geo)
usa_dx = read_csv(usa_dx_csv)
```

# Executive Summary {-}

Marine energy (offshore wind, tidal, wave) promises to diversify the U.S. renewable energy porfolio, which is important to reducing greenhouse gas emissions that contribute to climate change and reducing reliance on foreign non-renewable energy sources for national security. Development of these marine energy resources in the U.S. lags considerably behind Europe and other developed countries. The first (and currently only) U.S. commercial facility in Block Island, Rhode Island went into production December of 2016. As implementation costs for these technologies continue to drop and increasingly ambitious targets for renewable energy are set, planning of new marine renewable energy development needs to effectively ev competing ocean uses that may conflict.

Operation and maintenance of submarine cables may conflict with marine renewable energy development. Although submarine cable locations are publicly accessible, safe setback distances are not readily available for planning new marine renewable energy development.

We applied industry-advised safety buffers that varied with depth to existing submarine cables for "minimum" (2\*depth, i.e. "2z") and "recommended" (3\*depth, i.e. "3z") horizontal distances, both having a minimum 500 m buffer. Of the original `r accounting(lns_km, digits=0)` km in the "NOAA Charted Submarine cables in the United States as of December 2012" dataset (Figure \@ref(fig:mapCableTerritories)), `r accounting(lns_d1x_km, digits=0)` km fell within the 200 nm of the US exclusive economic zone (EEZ), which was analyzed across `r length(unique(lns_d1x$territory))` territories that overlapped with the cables (Figure \@ref(fig:mapCableBuffers)). A custom Equal Area Albers projection based on 1/6th the extent of each territory was individually applied to minimize spatial distortion when buffering distances at 100 m depth increments using the GEBCO 30 arc-second global grid. The cable buffer area ranged from `r hi = usa_dx %>% arrange(desc(cable3_pct)) %>% head(1); hi$cable3_pct %>% percent()` (`r hi$cable3_km2 %>% accounting(digits=0)` km^2^ [3z] of `r hi$area_km2 %>% accounting(digits=0)` km^2^ total) in the `r hi$territory` owing to many cables present and the steep continental shelf, to virtually nill `r lo = usa_dx %>% arrange(cable3_pct) %>% head(1); lo$cable2_pct %>% percent()` (`r lo$cable2_km2 %>% accounting(digits=0)` km^2^ [2z] of `r lo$area_km2 %>% accounting(digits=0)` km^2^ total) in `r lo$territory` (Table 2).

Overlap of cable buffers with marine renewable energy was assessed for tidal, wave and wind energy based on estimates from the National Renewable Energy Lab (NREL). Generally the highest proportion of energy is in the lower classes least likely for development where the highest area of overlap with cable buffers also exist (Figure \@ref(fig:pltEnergy); Table 3). The highest wind speed classes (10-11 & 11-12 m/s) are however also occupied by the highest percentage of cable buffer overlap (55.7% & 39.8% for 3z, 39.8% & 15.9% for 2z respectively). These uncommon high wind speed areas are limited to Hawaii and West territories (Table 6; Figure \@ref(fig:pltWind) for bargraph; Figure \@ref(fig:HawaiiMapWind) for Hawaii wind map; Figure \@ref(fig:WestMapWind) for West wind map). Overall wave energy has a bimodal distribution, most abundant in the lowest class (997,570 km^2^ for 0-10 kW/m) with a sharp drop at the next lowest class (292,692 km^2^ for 0-10 kW/m) and then ramping up to roughly half the highest class (532,533 km^2^ for >30 kW/m). Overlap with cable buffers for the highest two classes (20-30 & >30 kW/m) is just over 5% (5.2% & 5% for 2z, 6.8% & 6.7% for 3z). Similar to wind, these high energy wave classes are limited to the Pacific territories of Hawaii, West and  Alaska (wind for Alaska was not available) (Table 5; Figure \@ref(fig:pltWave) for bargraph; Figure \@ref(fig:HawaiiMapWave) for Hawaii wave map; Figure \@ref(fig:WestMapWave) for West wave map; Figure \@ref(fig:AlaskaMapWave) for Alaska wave map). Tidal power is extremely dominated by the lowest energy class of 0-500 W/m^2^ covering 403,781 km^2^, which is 99.6% of the total area assessed. The cable overlap for the rare higher energy areas is at most 20.1% (12 of 59 km^2^) for 500-1,000 W/m^2^ in the West and less than 3% for the even rarer higher energy classes of 1,000-1,500 or >1,500 found only in Alaska or the East.

# Background

Demand for abundant and diverse resources in the oceans is growing, necessitating marine spatial planning. To inform development of Marine Hydrokinetic (MHK) and Offshore Wind (OSW) resources, the Department of Energy (DOE) has asked NREL to identify — and mitigate where possible — the competing uses between MHK/OSW technologies and subsea power/telecom cables. The first step in this work is to identify and quantify the overlap between the MHK/OSW resource availability and existing cable routes. Several publicly available data layers are available that identify cable routes (e.g. MarineCadastre.gov currently hosts an offshore cables geographical information system (GIS) data layer) and MHK/OSW resource density (MHK Atlas, Wind Prospector). The cable route linear features, however, do not indicate the setback distance necessary to accommodate subsea cable maintenance requirements. Preliminary work was done within NREL to evaluate the influence of subsea cable setback distance on the overlap with MHK/OSW for the west coast of the U.S [@amante_offshore_2016]. Industry reports [@communicationssecurityreliabilityandinteroperabilitycounciliv_clustering_2016; @communicationssecurityreliabilityandinteroperabilitycounciliv_protection_2014] from the International Cable Protection Committee (ICPC) of the North American Submarine Cable Association (NASCA)^[North American Submarine Cable Association (NASCA): https://www.n-a-s-c-a.org] advise on setback distances that inform this analysis.

# Methods

## Study Area, Submarine Cables, Depth and Energy Data

The study area consisted of the US waters [@flandersmarineinstitute_maritime_2016], i.e. the 200 nm extent deemed the exclusive economic zone (EEZ), that overlapped with the offshore cable dataset "NOAA Charted Submarine cables in the United States as of December 2012" available through MarineCadastre.gov ^[MarineCadastre.gov cable metadata: https://coast.noaa.gov/dataservices/Metadata/TransformMetadata?u=https://coast.noaa.gov/data/Documents/Metadata/harvest/MarineCadastre/NOAAChartedSubmarineCables.xml&f=html]. The territory of the contiguous US was further divided into West, East and Gulf of Mexico territories based on the Gulf of Mexico description from the International Hydrographic Organization (IHO) Sea Areas [@vliz_iho_2017]. To accomodate territories overlapping the international dateline (Hawaii and Alaska), all input and output products were shifted from [-180,180] to [0,360]. For more details on the 12 territories used in this analysis, see Table 1 and Figure \@ref(fig:mapCableTerritories).

```{r mapCableTerritories, fig.cap='Map of NOAA charted submarine cables (red lines) as of December 2012 within the exclusive economic zone (EEZ; 200 nm) overlapping with United States territories.'}
fig = 'figs/mapCableTerritories' # redo=T
fig_ext = sprintf('%s.%s', fig, fig_type) # redo=T
if (!file.exists(fig_ext) | redo){

  cables = read_sf(lns_geo) %>%                      # cables
    mutate(
      geometry = (geometry + c(360,90)) %% c(360) - c(0,90)) %>%
    st_set_crs(crs_gcs_w)
  eez    = read_sf(usa_rgn_s_geo) %>%                # eez territories
    arrange(territory) %>%
    mutate(
      id        = row_number(),
      territory = factor(territory, territory, label=sprintf('%d.%s', id, territory)),
      pt_geom   = st_centroid(geometry),
      x         = sapply(pt_geom, "[[", 1),
      y         = sapply(pt_geom, "[[", 2))
  land   = st_as_sf(map('world2', plot=F, fill=T))   # land
  
  bb = st_bbox(cables)
  col_n  = length(eez$territory)
  col_pal = colorRampPalette(brewer.pal(11,'Spectral'))(col_n)
  
  p = ggplot(eez) +
    geom_sf(aes(fill=territory), color=NA, alpha=0.4) +
    scale_fill_manual('US Territory', values = col_pal) +
    geom_sf(data=cables, color='red', size=0.1, alpha=0.9) +
    geom_sf(data=wrld2, fill='gray60', color='gray80') +
    geom_text(data=eez, aes(x,y,label=id), color='black') +
    coord_sf(
      xlim=bb[c('xmin','xmax')], 
      ylim=bb[c('ymin','ymax')]) +
    theme(
      legend.background = element_rect(fill='grey90'),  
      legend.key = element_blank(),
      axis.title.x=element_blank(),
      axis.title.y=element_blank())

  if (fig_type=='pdf'){
    pdf(fig_ext, width=6.5, height=5)
  }  else {
    png(fig_ext, res=fig_dpi, width=6.5, height=5, units='in')
  }
  print(p)
  dev.off()
}
#system(sprintf('open %s', fig_ext))
knitr::include_graphics(fig_ext, auto_pdf=F, dpi=fig_dpi)
```

```{r tbl01Territories}
# territories with energy
ter_energy = map2(
  c(wind_depth_cbls_csv, wave_depth_cbls_csv, tide_depth_cbls_csv), 
  c('wind','wave','tide'), 
  read_cbls) %>%
  bind_rows() %>%
  group_by(territory, form) %>%
  summarize(
    has_form = T) %>%
  filter(territory != 'ALL') %>%
  spread(form, has_form)
write_csv(ter_energy, '../data/energy_territories.csv')

# territory cable lengths
ter_cables = read_sf(lns_d1x_rgn_geo) %>%
  mutate(
    length=st_length(geometry)) %>%
  st_set_geometry(NULL) %>%
  group_by(territory) %>%
  summarize(
    length=sum(length, na.rm=T))

# Other territories: lump those without any energy
ter_other = setdiff(ter_cables$territory, ter_energy$territory)
# paste(ter_other, collapse=', ') # Guam, Johnston Atoll, N Mariana Islands, Palmyra Atoll, Wake Island
write_lines(ter_other, ter_other_txt)

# ter_cables: summarize other 
ter_cables = ter_cables %>%
  filter(
    !territory %in% ter_other) %>%
  bind_rows(
    tibble(
      territory = 'Other',
      length = ter_cables %>%
        filter(
          territory %in% ter_other) %>%
        summarize(length=sum(length)) %>%
        .$length)) %>%
  mutate(length_km = length %>% as.numeric() / 1000) %>%
  select(territory, length_km)

# territory areas
ter_area = read_sf(usa_rgn_s_geo) %>%
  select(territory, area_km2) %>% 
  st_set_geometry(NULL) #%>%
# ter_area: summarize Other
ter_area = ter_area %>%
  filter(
    !territory %in% ter_other) %>%
  bind_rows(
    tibble(
      territory = 'Other',
      area_km2 = ter_area %>%
        filter(
          territory %in% ter_other) %>%
        summarize(area_km2=sum(area_km2)) %>%
        .$area_km2))
  
ter_smry = ter_area %>%
  left_join(
    ter_cables, by='territory') %>%
  left_join(
    ter_energy, by='territory') %>%
  mutate(
    length_km = accounting(round(length_km), format='d'),
    area_km2  = accounting(round(area_km2), format='d'),
    tide  = ifelse(!is.na(tide), '✓', ''),
    wave  = ifelse(!is.na(wave), '✓', ''),
    wind  = ifelse(!is.na(wind), '✓', '')) %>%
  select(
    Territory     = territory,
    `Territory (km2)` = area_km2,
    `Cable (km)`    = length_km,
    `Tidal` = tide,
    `Wave`  = wave,
    `Wind`  = wind)

ter_smry %>%
  formattable(list(
    `Territory (km2)` = color_bar('lightgray'),
    `Cable (km)`    = color_bar('lightgray'))) %>%
  as.datatable(
    rownames = F,
    caption  = 'Table 1: Territories having submarine cables within the United States exclusive economic zone (EEZ) of 200 nm. Territory area (km2) and summed length of submarine cables (km) are reported with light gray horizontal bars to visually indicate value relative to rest of column. Remaining columns indicate whether energy resources (tidal, wave or wind) are characterized for the territory. Territories having submarine cables but no energy resource characterization are lumped into "Other" territories: Guam, Johnston Atoll, N Mariana Islands, Palmyra Atoll, Wake Island.',
    options  = list(
      dom='t', # off: n_entries/search/paging/ordering
      pageLength = nrow(tbl), ordering=F,
      columnDefs = list(
        list(className='dt-right', targets=0:2),
        list(className='dt-center', targets=3:5))))
```

Bathymetric depth comes from the [GEBCO 30 arc-second grid](http://www.gebco.net/data_and_products/gridded_bathymetry_data/gebco_30_second_grid/)^[GEBCO_2014 Grid, version 20150318, www.gebco.net].

The marine renewable energy datasets are from NREL and accessible online via NREL's Wind Prospector^[NREL Wind Prospector: https://maps.nrel.gov/wind-prospector/] and MHK Atlas^[NREL MHK Atlas: https://maps.nrel.gov/mhk-atlas]. Tidal data were modeled using the Regional Ocean Modeling System and calibrated with available measurements of tidal current speed and water level surface in terms of watts per square meter (W/m^2^) [@haas_assessment_2011]. Wave data is based on a 51-month Wavewatch III hindcast database developed by the National Oceanographic and Atmospheric Administration’s (NOAA’s) National Centers for Environmental Prediction for estimation of wave power density in terms of kilowatts per meter (kW/m) [@Jacobson_Hagerman_Scott_2011]. Wind data is for average offshore wind speed in meters per second (m/s) at a 90 m hub height ^[Wind data for 90-meter offshore: http://www.nrel.gov/gis/data_wind.html].

TODO:
- digest report: DOI (2014) Offshore Wind Submarine Cable Spacing Guidance
- wind: <= 1,000 m [@musial_2016_2016; @schwartz_assessment_2010]
- tidal: <= 100 m [@haas_assessment_2011]
- wave: <=  200 m [@Jacobson_Hagerman_Scott_2011]

## Submarine Cable Avoidance Zones

The International Cable Protection Committee (ICPC) of the North American Submarine Cable Association (NASCA) outlined recommendations for siting new offshore renewable wind energy facilities and routing new cables. For new facilities they recommend a minimum of 500 m and further offshore twice the depth to the seafloor, per ICPC Recommendation 13 No. 2 [ @communicationssecurityreliabilityandinteroperabilitycounciliv_protection_2014]. So for depths <= 250 m, a 500 m buffer from the cables applies and for depths > 250 m, 2 \* depth is to be used. For placing new submarine cables, seperation distances are specified for minimum (2 \* depth) and recommended (3 \* depth), per related to ICPC Recommendation 2 No. 10 [@communicationssecurityreliabilityandinteroperabilitycounciliv_protection_2014]. We combined these two criteria into 2 sets of buffer distances for minimum ("2z": 2 \* depth) and recommended ("3z": 3 \* depth) avoidance zones, both with a minimum 500 m width. 

## Depth-Varying Cable Buffer

A depth-varying buffer for "minimum" (2z) and "recommended" (3z) was achieved by intersecting depth with cables and buffering out by depth. Depth from the GEBCO grid was reclassed into 100 m increments starting with 250 m to apply a 500 m minimum for the 2z and 3z products, and converted to polygons for intersecting with the cable linear features. A custom Albers Equal Area Conic projection based on 1/6th the extent ^[The "one-sixth rule" for Albers Equal Area Conic projection: http://desktop.arcgis.com/en/arcmap/latest/map/projections/albers-equal-area-conic.htm#GUID-2158C4F9-F197-458E-94F0-84933C1BE6B7] of each territory was individually applied to minimize spatial distortion when buffering.

# Results

All analytical code to generate outputs, inclulding this data driven report, are available in a publicly accessible online repository: [http://github.com/ecoquants/nrel-cables](http://github.com/ecoquants/nrel-cables). Here are particularly noteworthy files:

- `data/`
    * [`lns_d1x.geojson`](https://github.com/ecoquants/nrel-cables/blob/master/data/lns_d1x.geojson): lines of submarine cables segmented at 100 m increments with depth value for buffering, ie minimum 500 m and depth (z) for multiplying by 2 (2z) or 3 (3z).
    * [`buf_2xdepth_incr100m.geojson`](https://github.com/ecoquants/nrel-cables/blob/master/data/buf_2xdepth_incr100m.geojson): polygons for "minimum" avoidance zone for buffer at twice the depth (2z), mimimum 500 m.
    * [`buf_3xdepth_incr100m.geojson`](https://github.com/ecoquants/nrel-cables/blob/master/data/buf_3xdepth_incr100m.geojson): polygons for "recommended" avoidance zone for buffer at three times the depth (3z), mimimum 500 m.
- `docs/`
    * [`packages_vars.R`](https://github.com/ecoquants/nrel-cables/blob/master/docs/packages_vars.R): R code with variables and packages used across analysis (`create_cable-buffer.R`, `extract_cable-energy.R`) and reporting (`report.Rmd`)
    * [`create_cable-buffer.R`](https://github.com/ecoquants/nrel-cables/blob/master/docs/create_cable-buffer.R): R code to generate cable buffers at 100 m depth increments.
    * [`extract_cable-energy.R`](https://github.com/ecoquants/nrel-cables/blob/master/docs/extract_cable-energy.R): R code to extract renewable energy for cabled territories.
    * [`report.Rmd`](https://github.com/ecoquants/nrel-cables/blob/master/docs/report.Rmd): R markdown document for reproducible, data-driven generation of various report output file formats (`report.pdf`, `report.docx`, `report.html`)

## Cable Buffer

Of the original `r accounting(lns_km, digits=0)` km in the "NOAA Charted Submarine cables in the United States as of December 2012" dataset (Figure \@ref(fig:mapCableTerritories)), `r accounting(lns_d1x_km, digits=0)` km fell within the 200 nm of the US exclusive economic zone (EEZ), which was analyzed across `r length(unique(lns_d1x$territory))` territories that overlapped with the cables (Figure \@ref(fig:mapCableBuffers)). The cable buffer area ranged from `r hi = usa_dx %>% arrange(desc(cable3_pct)) %>% head(1); hi$cable3_pct %>% percent()` (`r hi$cable3_km2 %>% accounting(digits=0)` km^2^ [3z] of `r hi$area_km2 %>% accounting(digits=0)` km^2^ total) in the `r hi$territory` owing to many cables present and the steep continental shelf, to virtually nill `r lo = usa_dx %>% arrange(cable3_pct) %>% head(1); lo$cable2_pct %>% percent()` (`r lo$cable2_km2 %>% accounting(digits=0)` km^2^ [2z] of `r lo$area_km2 %>% accounting(digits=0)` km^2^ total) in `r lo$territory` (Table 2).

```{r tbl02CableBufferTerritories}
caption  = "Table 2: Overlap of cable seperation schemes for new facilities (2 * depth) and new cables (3 * depth) with area of territory as absolute area (km2) or as a percentage (%) of territory area. Horizontal bars indicate value relative to rest of column. Territories having submarine cables but no energy resource characterization (tidal, wind or wave) are lumped into \"Other\" territories: Guam, Johnston Atoll, N Mariana Islands, Palmyra Atoll, Wake Island."

ter_other = read_lines(ter_other_txt)

ter_tbl = usa_eez %>%
  st_set_geometry(NULL)

tbl = ter_tbl %>%
  left_join(
    dx2 %>% 
      st_set_geometry(NULL) %>%
      rename(cable2_km2 = area_km2),
    by='territory') %>%
  left_join(
    dx3 %>% 
      st_set_geometry(NULL) %>% 
      rename(cable3_km2 = area_km2),
    by='territory')

tbl = tbl %>%
  arrange(territory) %>%
  filter(
    !territory %in% ter_other) %>%
  bind_rows(
    bind_cols(
      territory = 'Other',
      tbl %>%
        filter(
          territory %in% ter_other) %>%
        summarize(
          area_km2 = sum(area_km2),
          cable2_km2 = sum(cable2_km2),
          cable3_km2 = sum(cable3_km2)))) %>%
  mutate(
    cable2_pct = cable2_km2 / area_km2,
    cable3_pct = cable3_km2 / area_km2) %>%
  select(
    territory, area_km2,
    cable2_km2, cable2_pct, cable3_km2, cable3_pct)
write_csv(tbl, usa_dx_csv)

hdr = withTags(table(
  class = 'display',
  thead(
    tr(
      th(colspan=2, 'Territory'),
      th(colspan=2, 'Facilities (2z)'),
      th(colspan=2, 'Cables (3z)')),
    tr(
      th('Name'),
      th(HTML('Area (km<sup>2</sup>)')),
      th(HTML('Area (km<sup>2</sup>)')),
      th('(%)'),
      th(HTML('Area (km<sup>2</sup>)')),
      th('(%)')))))

tbl %>%
  mutate(
    area_km2   = accounting(area_km2, digits=0),
    cable2_km2 = accounting(cable2_km2, digits=0),
    cable3_km2 = accounting(cable3_km2, digits=0),
    cable2_pct = percent(cable2_km2 / area_km2, digits=1),
    cable3_pct = percent(cable3_km2 / area_km2, digits=1)) %>%
  formattable(
    list(
      area_km2   = color_bar('lightgray'),
      cable2_km2 = color_bar('lightpink'),
      cable2_pct = color_bar('lightpink'),
      cable3_km2 = color_bar('lightgreen'),
      cable3_pct = color_bar('lightgreen'))) %>%
  as.datatable(
    rownames=F, container=hdr, caption=caption,
    options = list(
      dom='t', # off: n_entries/search/paging/ordering
      pageLength = nrow(tbl), ordering=F,
      columnDefs = list(list(className='dt-right', targets=1:5))))
```

## Overlap of Cable Buffer with Renewable Energy

Generally the highest proportion of energy is in the lower classes least likely for development where the highest area of overlap with cable buffers also exist (Figure \@ref(fig:pltEnergy); Table 3). The highest wind speed classes (10-11 & 11-12 m/s) are however also occupied by the highest percentage of cable buffer overlap (55.7% & 39.8% for 3z, 39.8% & 15.9% for 2z respectively). These uncommon high wind speed areas are limited to Hawaii and West territories (Table 6; Figure \@ref(fig:pltWind) for bargraph; Figure \@ref(fig:HawaiiMapWind) for Hawaii wind map; Figure \@ref(fig:WestMapWind) for West wind map). Overall wave energy has a bimodal distribution, most abundant in the lowest class (997,570 km^2^ for 0-10 kW/m) with a sharp drop at the next lowest class (292,692 km^2^ for 0-10 kW/m) and then ramping up to roughly half the highest class (532,533 km^2^ for >30 kW/m). Overlap with cable buffers for the highest two classes (20-30 & >30 kW/m) is just over 5% (5.2% & 5% for 2z, 6.8% & 6.7% for 3z). Similar to wind, these high energy wave classes are limited to the Pacific territories of Hawaii, West and  Alaska (wind for Alaska was not available) (Table 5; Figure \@ref(fig:pltWave) for bargraph; Figure \@ref(fig:HawaiiMapWave) for Hawaii wave map; Figure \@ref(fig:WestMapWave) for West wave map; Figure \@ref(fig:AlaskaMapWave) for Alaska wave map). Tidal power is extremely dominated by the lowest energy class of 0-500 W/m^2^ covering 403,781 km^2^, which is 99.6% of the total area assessed. The cable overlap for the rare higher energy areas is at most 20.1% (12 of 59 km^2^) for 500-1,000 W/m^2^ in the West and less than 3% for the even rarer higher energy classes of 1,000-1,500 or >1,500 found only in Alaska or the East.

```{r pltEnergy, fig.cap='Energy by area and power class per US territory with cable overlay (minimum - recommended %).'}

#tbl_form_cbls
#View(tbl_form_cbls)
  
# mutate(
#   energy = factor(
#     x      = sprintf('%s_%04d', form, energy_num), 
#     levels = sprintf('%s_%04d', form, energy_num), 
#     label  = energy_lbl, ordered=T))


# depth_levels = c(-5000,      50,       150,         600,     5000)
# depth_labels = c( '<0', '0-100', '100-200', '200-1,000', '>1,000')
# tide_breaks = c(0,500,1000,1500,10753)
# tide_labels = c('0-500','500-1,000','1,000-1,500','>1,500')
# wind_labels = c('<=7', '7-8', '8-9', '9-10', '10-11', '11-12')
# wave_labels = c('0-10','10-20','20-30','>30')


cable_ord = c('min_2d'='Min.(2z)', 'rec_3d'='+Rec.(3z)', 'rem'='Free')
  
#View(tbl_form_cbls)
tbl_form_cbls = map2(
  c(wind_depth_cbls_csv, wave_depth_cbls_csv, tide_depth_cbls_csv), 
  c('wind','wave','tide'), 
  read_cbls) %>%
  bind_rows() %>%
  mutate(
    depth  = ifelse(is.na(depth), depth_factor, depth),
    energy = ifelse(is.na(energy), energy_factor, energy)) %>%
  select(-depth_factor, -energy_factor) %>%
  filter(
    territory == 'ALL',
    depth != '<0') %>%
  #select(-territory) %>%
  mutate(
    depth  = factor(depth, depth_labels, ordered=T),
    energy = factor(
      sprintf('%s %s', energy, c(tide='W/m^2',wave='kW/m',wind='m/s')[form]),
      c(
        sprintf('%s W/m^2', tide_labels),
        sprintf('%s kW/m', wave_labels),
        sprintf('%s m/s', wind_labels)), 
      ordered=T)) %>%
  select(form, depth, energy, area_km2, cable2_km2, cable2_pct, cable3_km2, cable3_pct) %>%
  arrange(form, depth, energy)

write_csv(tbl_form_cbls, '../data/energy-depth-cables_all.csv')

# View(tbl_form_cbls %>% arrange(form, depth, energy))

#paste(names(tbl_form_cbls), collapse=', ')
d_p = tbl_form_cbls %>%
  filter(
    # summarize by depths relevant to energy
    !(form=='tide' & depth %in% c('0-100')),
    !(form=='wave' & depth %in% c('0-100','100-200')),
    !(form=='wind' & depth %in% c('0-100','100-200','200-1,000')),
    # remove lowest classes
    !(form=='tide' & energy == '0-500 W/m^2'),
    !(form=='wave' & energy == '0-10 kW/m'),
    !(form=='wind' & energy == '<=7 m/s')) %>%
  group_by(form, energy) %>%
  summarize(
    area_km2 = sum(area_km2),
    cable2_km2 = sum(cable2_km2),
    cable3_km2 = sum(cable3_km2)) %>%
  ungroup() %>%
  mutate(
    min_2d = cable2_km2,
    rec_3d = cable3_km2 - cable2_km2,
    rem    = area_km2 - cable3_km2) %>%
  select(
    form, energy, min_2d, rec_3d, rem) %>%
  gather(type, km2, -energy, -form) %>%
  mutate(
    type = factor(
      type,
      names(cable_ord),
      cable_ord, ordered=T)) %>%
  arrange(form, energy, type)

txt_adj = tbl_form_cbls %>% 
  summarize(txt_adj = max(area_km2)/1000*0.025) %>% 
  .$txt_adj

p = ggplot(
  data=d_p %>% filter(form %in% c('wave','wind')),
  aes(x = energy, y = km2/1000, fill=factor(type))) +
  #scale_fill_brewer(palette = 'Spectral') +
  geom_col() +
  # geom_text(
  #   data=tbl_form_cbls, 
  #   aes(label=pct_lbl, x=energy, y=area_km2/1000, fill=NULL), 
  #   position = position_nudge(y = txt_adj), size=2) +
  labs(
    #title    = 'Energy by Area and Power Class per US Territory', 
    #subtitle = 'with Cable Overlay (Minimum - Recommended %)', 
    x='Energy', y='Area (1,000 km^2)', fill='Cable') +
  theme(
    legend.justification = c(1,1), 
    legend.position      = c(1,1),
    axis.text.x = element_text(angle = 90, hjust = 1)) + 
  facet_wrap(~form, scales='free_x')
print(p)


p = ggplot(
  data=d_p %>% filter(form %in% c('tide')),
  aes(x = energy, y = km2/1000, fill=factor(type))) +
  #scale_fill_brewer(palette = 'Spectral') +
  geom_col() +
  # geom_text(
  #   data=tbl_form_cbls, 
  #   aes(label=pct_lbl, x=energy, y=area_km2/1000, fill=NULL), 
  #   position = position_nudge(y = txt_adj), size=2) +
  labs(
    #title    = 'Energy by Area and Power Class per US Territory', 
    #subtitle = 'with Cable Overlay (Minimum - Recommended %)', 
    x='Energy', y='Area (1,000 km^2)', fill='Cable') +
  theme(
    legend.justification = c(1,1), 
    legend.position      = c(1,1),
    axis.text.x = element_text(angle = 90, hjust = 1)) + 
  facet_wrap(~form, scales='free_x')
print(p)
```

```{r tbl03Energy}
d = tbl_form_cbls
energy_hdr = 'Amount'
caption = 'Table 3: Area overlap with cables by form of energy broken into size classes across all territories.'

# update energy column for proportion in color_box
e_lbls = c(
    '7=>','7-8',  '8-9','9-10','10-11','11-12', #  1:6
   '0-10',   '10-20',    '20-30',  '30<',       #  7:10
  '0-500','500-1000','1000-1500','1500<')       # 11:14

e_idx = c(1,7,11, 2,8,12, 3, 4,9,13, 5,10,14, 6) # setdiff(1:length(e_lbls), e_idx) 
e_lkup = setNames(e_idx, 1:14)
d = d %>% 
  mutate(
    form = ifelse(
      duplicated(form), '',       c(
        'tide'='Tidal Power (W/m2)',
        'wave'='Wave Energy (kW/m)',
        'wind'='Wind Speed (m/s)')[d$form]),
    energy = factor(
      x = e_lkup %>% sort() %>% names %>% as.integer,
      levels = 1:14,
      labels = e_lbls[e_idx],
      ordered=T),
    area_km2   = accounting(area_km2, digits=0),
    cable2_km2 = accounting(cable2_km2, digits=0),
    cable3_km2 = accounting(cable3_km2, digits=0),
    cable2_pct = percent(cable2_pct, digits=1),
    cable3_pct = percent(cable3_pct, digits=1)) %>%
  select(
    form, energy, area_km2,
    cable2_km2, cable2_pct, cable3_km2, cable3_pct)

hdr = htmltools::withTags(table(
  class = 'display',
  thead(
    tr(
      th(rowspan=2, 'Energy'),
      th(rowspan=2, 'Class'),
      th(rowspan=2, HTML('Area (km<sup>2</sup>)')),
      th(colspan=2, 'Min. Cable (2z)'),
      th(colspan=2, 'Rec. Cable (3z)')),
    tr(
      th(HTML('Area (km<sup>2</sup>)')),
      th('(%)'),
      th(HTML('Area (km<sup>2</sup>)')),
      th('(%)')))))

d %>%
  formattable(
    list(
      energy     = color_bar('lightblue'),
      area_km2   = color_bar('lightgray'),
      cable2_km2 = color_bar('lightpink'),
      cable3_km2 = color_bar('lightgreen'))) %>%
  as.datatable(
    rownames=F, container=hdr,
    caption = caption,
    options = list(
      dom='t', # off: n_entries/search/paging/ordering
      pageLength = nrow(d), ordering=F,
      columnDefs = list(list(className='dt-right', targets=1:5))))

# d %>%
#   format_table(
#     list(
#       energy     = color_bar('lightblue'),
#       area_km2   = color_bar('lightgray'),
#       cable2_km2 = color_bar('lightpink'),
#       cable3_km2 = color_bar('lightgreen')),
#     caption=caption)
```

### Tidal

```{r pltTide, fig.cap='Tidal power (W/m2) and area per US territory with cable overlay (minimum - recommended %).'}
plot_cbls(
  csv   = tide_cbls_csv, 
  #title = 'Tidal Energy by Area and Power Class per US Territory',
  xlab  = 'Tidal power (W/m2)',
  legend_position      = c(1,1),
  legend_justification = c(1,1))
```

```{r tbl04Tide}
fmt_tbl(
  csv        = tide_cbls_csv, 
  energy_hdr = 'Tidal power (W/m2)',
  caption    = 'Table 4: Area overlap with cables for tidal power (W/m2) by territory.')
```

### Wave

```{r pltWave, fig.cap='Wave energy (kW/m) and area per US territory with cable overlay (minimum - recommended %).'}
plot_cbls(
  csv   = wave_cbls_csv,
  #title = 'Wave Energy by Area and Power Class per US Territory',
  xlab  = 'Wave energy (kW/m)')
```

```{r tbl05Wave}
fmt_tbl(
  csv        = wave_cbls_csv, 
  energy_hdr = 'Wave Energy (kW/m)',
  caption    = 'Table 5: Area overlap with cables for wave energy (kW/m) by territory.')
```

### Wind

```{r pltWind, fig.cap='Wind speed (m/s) at 90m hub height and area per US territory with cable overlay (minimum - recommended %).'}
plot_cbls(
  csv   = wind_cbls_csv, 
  #title = 'Wind Energy by Area and Power Class per US Territory',
  xlab  = 'Wind speed (m/s)',
  # legend_position      = c(0,0.47),
  # legend_justification = c(0,1))
  legend_justification = c(1,1), 
  legend_position      = c(1,1))
```

```{r tbl06Wind}
fmt_tbl(
  csv=wind_cbls_csv, energy_hdr='Wind Speed (m/s)',
  caption='Table 6: Area overlap with cables for wind speed (m/s) at 90m hub height by territory.')
```

# Conclusions

Given climate change impacts of fossil fuel energy production [@pachauri_climate_2015], development of clean renewable energy alternatives are imperative for the sustainable future of the United States and rest of the planet. These energy sources however vary widely in geographic and temporal availability and may compete with other uses. The submarine cable industry provides critical power and telecommunication services, such that safe operation and maintenance must be heeded as marine renewable energy sources are developed [@communicationssecurityreliabilityandinteroperabilitycounciliv_clustering_2016; @communicationssecurityreliabilityandinteroperabilitycounciliv_protection_2014]. The submarine cable safety avoidance zones created and evaluated through this report are products intended to minimize conflict at the plannnig stage between these competing uses.

Although the US currently only has one marine renewable energy facility in full production at Block Island NJ, many more are in pilot and proposal phases with much future potential [@beiter_assessment_2017; @lehmann_ocean_2017; @uihlein_wave_2016]. These spatial avoidance zones are advisory. Should there be overlapping interest, negotiations between renewable energy developers and cable operators should be sought.

# (APPENDIX) Appendix {-} 

# Detailed Maps by US Territory of Cable Buffer and Renewable Energy

```{r mapCable}
for (ter in sort(unique(lns_d1x$territory))){ # ter = 'Hawaii'
  fig = sprintf('figs/mapCable_%s', str_replace_all(ter,' ','-'))
  map_cable(
    ter = ter,
    fig = fig,
    redo = redo)
  #system(sprintf('open %s', fig))
}
#knitr::include_graphics(sprintf('figs/mapCable_%s.pdf', str_replace_all(unique(lns_d1x$territory),' ','-')), dpi=fig_dpi)
```

```{r mapTide}
territories = read_csv(tide_cbls_csv) %>% 
  filter(territory !='ALL') %>% 
  .$territory %>% unique()

for (ter in territories){ # ter = 'Hawaii'
  map_tide(
    ter = ter,
    legend_title = 'Tidal\npower\n(W/m2)',
    fig = sprintf('figs/mapTide_%s', str_replace_all(ter,' ','-')),
    redo = redo)
  #system(sprintf('open %s', fig))
}
#knitr::include_graphics(sprintf('figs/mapTide_%s.pdf', str_replace_all(territories,' ','-')), dpi=fig_dpi)
```

```{r mapWave}
wave_sf = read_sf(wave_geo) %>%
  filter(!is.na(territory)) %>%
  mutate(
    energy = factor(
      energy_num, unique(energy_num), unique(energy_lbl), ordered=T))

for (ter in unique(wave_sf$territory)){ # ter = 'Hawaii'
  map_energy_sf(
    energy_sf = wave_sf,
    ter = ter,
    legend_title = 'Wave\nenergy\n(kW/m)',
    redo = redo,
    fig = sprintf('figs/mapWave_%s', str_replace_all(ter,' ','-')))
  #system(sprintf('open %s', fig))
  #knitr::include_graphics(fig, dpi=fig_dpi)
}
#knitr::include_graphics(sprintf('figs/mapWave_%s.pdf', str_replace_all(unique(wave_sf$territory),' ','-')), dpi=fig_dpi)
```

```{r mapWind}
wind_sf = read_sf(wind_geo) %>%
  arrange(energy_num) %>%
  mutate(
    energy = factor(
      energy_num, unique(energy_num), unique(energy_lbl), ordered=T)) %>%
  arrange(region, energy)

for (ter in unique(wind_sf$territory)){ # ter = 'Hawaii'
  map_energy_sf(
    energy_sf = wind_sf,
    ter = ter,
    legend_title = 'Wind\nspeed\n(m/s)',
    redo = redo,
    fig = sprintf('figs/mapWind_%s', str_replace_all(ter,' ','-')))
  #system(sprintf('open %s', fig))
  #knitr::include_graphics(fig, dpi=fig_dpi)
}
#knitr::include_graphics(sprintf('figs/mapWind_%s.pdf', str_replace_all(unique(wind_sf$territory),' ','-')), dpi=fig_dpi)
```

```{r srcTerritoryTemplate, include=F, cache=F}
src = lapply(
  sort(unique(lns_d1x$territory)), 
  function(
    ter,
    ter_hyp   = str_replace_all(ter, ' ', '-'),
    ter_str   = str_replace_all(ter, ' ', ''),
    map_cable = sprintf('figs/mapCable_%s.%s', ter_hyp, fig_type),
    map_tide  = sprintf('figs/mapTide_%s.%s', ter_hyp, fig_type),
    map_wave  = sprintf('figs/mapWave_%s.%s', ter_hyp, fig_type),
    map_wind  = sprintf('figs/mapWind_%s.%s', ter_hyp, fig_type),
    has_tide  = file.exists(map_tide),
    has_wave  = file.exists(map_wave),
    has_wind  = file.exists(map_wind)){
      knit_expand(file='territory_template.Rmd')})
# write_lines(src, 'test_src.Rmd')
```

`r knit(text = unlist(src))`

# References
