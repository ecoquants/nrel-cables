---
title: "Submarine Cable Analysis for Marine Renewable Energy Development"
csl: apa.csl
output:
  bookdown::html_document2:
    code_folding: hide
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float: yes
  bookdown::pdf_document2:
    toc: yes
  bookdown::word_document2:
    toc: yes
bibliography: nrel-cables.bib
---

```{r setup, include=FALSE}
library(knitr)

opts_chunk$set(warning=F, message=F)

if (opts_knit$get("rmarkdown.pandoc.to") == 'html'){
  opts_chunk$set(echo=T)
} else {
  opts_chunk$set(echo=F)
}

if (basename(getwd()) == 'nrel-cables') setwd('docs')
```

# Introduction

Previous preliminary work [@amante_offshore_2016] and a couple industry reports [@communicationssecurityreliabilityandinteroperabilitycounciliv_clustering_2016; @communicationssecurityreliabilityandinteroperabilitycounciliv_protection_2014] inform this report.

And another reference [@lopez_review_2013].

## Importance of Marine Renewable Energy

-  Marine renewables are an important off

- organizations:
    - ICPC: International Cable Protection Committee
    - NASCA: North American Submarine Cable Association

## Importance of Submarine Cables

- frequency of repair?

## Minimizing Conflict through Spatial Avoidance

"An effective submarine cable protection regime must account for the physical characteristics of submarine cables and the mechanical characteristics of the installation vessels and tools. These characteristics—along with weather, sea, and seabed conditions—greatly determine the specifics of a given cable installation or repair." [@communicationssecurityreliabilityandinteroperabilitycounciliv_protection_2014]

- Overlap of cables an issue? Yes

    "Clustering of Submarine Cable Systems: The clustering of submarine cables along particular routes (whether to avoid unfavorable sea floor topography, natural hazards, or man-made hazards such as dredging and dumping areas, fishing grounds, and energy infrastructure) increases the risk that installation or maintenance of one cable will cause direct physical disturbance to another, such as with plowing and grappling operations." [@communicationssecurityreliabilityandinteroperabilitycounciliv_protection_2014]


## Benefits of Cooperation

- Are cost savings possible through sharing cable infrastructure & maintenance between marine renewable energy transmission and existing submarine cables? 

- Direct ecological benefits can result from developing offshore energy, such as de facto reserve creation and creation of hard surfaces for habitat forming species. Are other benefits possible with coordinate marine spatial planning, particularly between cable and renewable industries?

[@pelc_renewable_2002; @gill_offshore_2005; @inger_marine_2009; @lester_evaluating_2013; @willsteed_assessing_2017]


# Methods

## Study Area

US EEZ for Pacific and Atlantic. Alaska & Hawaii?

## Data

See Table \@ref(tab:data-sources).

```{r data-sources, tidy=F}
library(tidyverse)

read_csv('../data/data_sources.csv') %>%
  kable(
    caption = 'Data sources from preliminary report.', booktabs=T)
```

### Submarine Cables

- [North American Submarine Cable Association (NASCA)](https://www.n-a-s-c-a.org/)
- data.noaa.gov:
    * [NOAA Charted Submarine cables in the United States as of December 2012 - NOAA Data Catalog](https://data.noaa.gov/dataset/noaa-charted-submarine-cables-in-the-united-states-as-of-december-2012)
    * [North American Submarine Cable Association (NASCA) Submarine Cables - NOAA Data Catalog](https://data.noaa.gov/dataset/north-american-submarine-cable-association-nasca-submarine-cables)

See Figure \@ref(fig:map).

```{r map, fig.cap='Map of NOAA Charted Submarine cables in the United States as of December 2012.'}
library(rgdal)
library(rgeos)
library(leaflet)

#setwd('~/github/nrel-cables')
gdb = '../data/SubmarineCables/NOAAChartedSubmarineCables.gdb'
fc = ogrListLayers(gdb)[[1]]
lns = readOGR(dsn=gdb, layer=fc, verbose=F)

# TODO: move these danglers to Pacific left of existing
idx = gCentroid(lns, byid=T) %>% coordinates() %>% .[,1] < 100
lns = subset(lns, idx)

leaflet(lns) %>%
  addProviderTiles('Esri.OceanBasemap') %>%  # 'Esri.OceanBasemap'/'Stamen.TonerLite'
  # see [all providers](http://leaflet-extras.github.io/leaflet-providers/preview/index.html)
  addPolylines(
    popup = ~sprintf("scaleBand: %s<br>description: %s<br>effectiveDate: %s", scaleBand, description, effectiveDate))
```

### Renewable Energy

NREL.

## Separation Zones for Routing New Cables

"ICPC Recommendation 2 No. 10: parallel submarine cables maintain a separation distance of the lesser of 3 times depth of water or (where not achievable) 2 times the depth of water following consultation and agreement between affected parties — a separation standard the principles of which also apply to spacing of submarine cables and other marine infrastructure"

At least 2 separation zones based on depth:

1. **Minimum**:  2 times the depth of water

1. **Recommended**: 3 times depth of water

Psudocode:

```
# convert depth (GEBCO 30 sec resolution) to polygons of cells
depth_cells = as.polygon(depth_raster)

# intersect cables with depth cells
cable_cells = intersect(cables_lines, depth_cells)

# buffer based on depth
cables_buffers = list()
for (x in unique(cable_cells$depth)){

  cables_buffers[str(x)] = cable_cells %>%
    subset(depth == x) %>%
    buffer(x)

}
cable_buf = merge(cables_buffers) 

# smooth out jagged edges between cells
cable_buf = simplify(cable_buf)
```

### Depth

The bathymetric depth comes from the [GEBCO 30 arc-second grid](http://www.gebco.net/data_and_products/gridded_bathymetry_data/gebco_30_second_grid/). Here's there requested attribution:

**GEBCO_2014 Grid, version 20150318, www.gebco.net**

![](http://images.vliz.be/resized/64940_general-bathymetric-chart-of-the-oceans-gebco.png)


```{r}
library(raster)
#library(marmap)

# files
depth_nc    = '../data/big/GEBCO_2014_2D.nc' # 1.87 GB -- too big for Github

# load depth
depth_r = raster(depth_nc, layer = 'elevation')

# extract to extent of submarine cable lines
#depth_rc = crop(depth_r, extent(lns))
xmin = -121.29; xmax = -120.59; ymin = 35.04; ymax = 35.55
depth_rc = crop(depth_r, extent(xmin, xmax, ymin, ymax)) # Morro Bay test
depth_rc[depth_rc > 0] = NA
depth_rc = depth_rc * -1
plot(depth_rc)

pal <- colorNumeric(
  c("blue","purple"),  # RColorBrewer::display.brewer.all()
  values(depth_rc), na.color = "transparent")

leaflet() %>% 
  addProviderTiles("Stamen.TonerLite") %>%
  addRasterImage(depth_rc, colors = pal, opacity = 0.8) %>%
  addLegend(pal = pal, values = values(depth_rc),
    title = "Depth") %>%
  addPolylines(
    data = lns, color='orange',
    popup = ~sprintf(
      "scaleBand: %s<br>description: %s<br>effectiveDate: %s", 
      scaleBand, description, effectiveDate)) %>%
  setView(
    seq(xmin, xmax, length.out=3)[2], 
    seq(ymin, ymax, length.out=3)[2], 
    zoom = 10)
```

```{r}
library(rgeos)
library(geosphere)
library(sf)

rds_dx2 = '../data/morro-bay_2xdepth.rds'
rds_dx3 = '../data/morro-bay_3xdepth.rds'

if(any(!file.exists(rds_dx2), !file.exists(rds_dx2))){

  # convert raster to vector
  depth_p = rasterToPolygons(depth_rc, dissolve=T)
  names(depth_p@data) = 'depth'
  plot(depth_p)
  
  lns_t = spTransform(lns, crs(depth_p))
  lns_i = raster::intersect(lns_t, depth_p) # 3 secs
  
  depths_m = lns_i@data %>%
    group_by(depth) %>%
    summarize(n = n())
  
  depths_m %>%
    arrange(desc(n))
  
  # Albers Equal Area, with one-sixth rule
  bb = bbox(lns_i)
  lat_range = extendrange(bb['y',],f=(1+2/6))
  crs_aea = CRS(
    sprintf(
      "+proj=aea +lat_1=%f +lat_2=%f +lat_0=%f +lon_0=%f +x_0=0 +y_0=0 +datum=WGS84 +ellps=WGS84 +units=m +no_defs",
      lat_range[1], lat_range[2], mean(lat_range), mean(bb['x',])))
  lns_a = spTransform(lns_i, crs_aea)
  
  #for (d in depths_m$depth){ # m = 8
  for (i in 1:nrow(depths_m)){ # i = 2
    d = depths_m$depth[i]
    cat(sprintf('%03d of %d: %d m\n', i, nrow(depths_m), d))
  
    lns_d = subset(lns_a, depth==d)
    buf_dx2 = gBuffer(lns_d, width=d*2)  
    buf_dx3 = gBuffer(lns_d, width=d*3)  
    
    if (i == 1){
      ply_dx2 = buf_dx2
      ply_dx3 = buf_dx3
    } else {
      ply_dx2 = raster::union(ply_dx2, buf_dx2)
      ply_dx3 = raster::union(ply_dx3, buf_dx3)
    }
  }
  ply_dx2 = gUnaryUnion(ply_dx2)
  ply_dx3 = gUnaryUnion(ply_dx3)
  
  ply_dx2 = spTransform(ply_dx2, crs(depth_p))
  ply_dx3 = spTransform(ply_dx3, crs(depth_p))
  
  saveRDS(ply_dx2, rds_dx2)
  saveRDS(ply_dx3, rds_dx3)
}

ply_dx2 = readRDS(rds_dx2)
ply_dx3 = readRDS(rds_dx3)

leaflet() %>% 
  addProviderTiles("Stamen.TonerLite", group = "B&W") %>%
  addProviderTiles('Esri.OceanBasemap', group = "Ocean") %>%  #
  addRasterImage(
    depth_rc, group='depth',
    colors = pal, opacity = 0.8) %>%
  addLegend(
    pal = pal, values = values(depth_rc),
    title = "Depth", position='bottomright') %>%
  addPolygons(
    data = ply_dx3, group='buffer: 3*depth',
    color='red', stroke=F, fillOpacity = 0.5) %>%
  addPolygons(
    data = ply_dx2, group='buffer: 2*depth', 
    color='red', stroke=F, fillOpacity = 0.5) %>%
  addPolylines(
    data = lns, group='cables', 
    color='black', opacity = 1, weight=1,
    popup = ~sprintf(
      "scaleBand: %s<br>description: %s<br>effectiveDate: %s",
      scaleBand, description, effectiveDate)) %>%
  addLayersControl(
    baseGroups = c("B&W", "Ocean"),
    overlayGroups = c("cables", "buffer: 3*depth", "buffer: 2*depth", 'depth'),
    options = layersControlOptions(collapsed = FALSE)) %>%
  setView(
    seq(xmin, xmax, length.out=3)[2], 
    seq(ymin, ymax, length.out=3)[2], 
    zoom = 10)
```


## Avoidance Zones for Siting New Facilities

"ICPC Recommendation 13 No. 2, which establishes a methodology for determining site-specific proximity limits between submarine cables and offshore wind facilities and a default separation distance in shallower waters of 500 meters on either side of an in-service submarine cable — a separation standard the principles of which also apply to other offshore renewable energy projects."
    
"Subsea Cables UK Guideline No. 6 (endorsed by NASCA), which establishes principles for determining safe proximity distances and negotiating proximity agreements between offshore wind farms and submarine cables and reflects extensive experience in the United Kingdom with managing spatial conflicts between offshore wind farms and submarine cables."

"endorse a default separation distance of 500 meters in water depths of less than 75 meters and the greater of 500 meters or two times the depth of water in greater water depths."

1. **Default separation distance** by depth:
    - `<= 250 m`: 500 m
    - `> 250 m`: 2 x depth

Psudocode:

```
# buffer based on depth
cables_buffers = list()
for (x in unique(cable_cells$depth)){

  cables_buffers[str(x)] = cable_cells %>%
    subset(depth == x) %>%
    buffer(x)

}
cable_buf = merge(cables_buffers) 

# smooth out jagged edges between cells
cable_buf = simplify(cable_buf)
```

## Overlay with Existing Renewable Energy

Extract absolute and percent area overlap between zones and renewable energy potential areas, possibly at various depth bins.

# Results


# Conclusions 

## Communication with Stakeholders

Products will be online and readily digestable by fisherman and other stakeholders.

# References
